<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    



<script type="module">

for( let i = 0; i < 1000000000; i++)
{
// This synchronous script is going to delay parsing of the DOM,
// so the DOMContentLoaded event is going to launch later.
} 

// const myPromise = new Promise((resolve, reject) => {

// console.log('s')

//   setTimeout(() => {
//     resolve('foo');
//     console.log('resolve foo')
//   }, 300);

const deferred = new Promise(function(resolve, reject) {

    try {

        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            resolve()
        }
        else {
            document.addEventListener('DOMContentLoaded', (start) => resolve())
        }

    } catch(error) {
        console.log(error)
    }


})

export default (fn) => deferred.then(fn)


//////
console.log('Module assigned to window.OneReady. Logged below:')
console.log(deferred)

deferred.then(() => start('one'))
deferred.then(() => start('two'))

// });
function start(message) {
    console.log('_message === ', message)
}

for( let i = 0; i < 1000000000; i++)
{} // This synchronous script is going to delay parsing of the DOM,
   // so the DOMContentLoaded event is going to launch later.



   /////////////
   /**
 * 
 * Returns a Promise that resolves when the DOM is ready
 * 
 */
// const documentReady = () => new Promise(resolve => {

// const { readyState } = document

// // resolve early if DOM is already ready
// // document ready states: loading, interactive, complete
// if (readyState === 'interactive' || readyState === 'complete') {

//     document.removeEventListener("DOMContentLoaded", resolve);
//     return resolve()

// }

// // otherwise, resolve when ready
// document.addEventListener('DOMContentLoaded', resolve)
// })

// // export the Promise, not the generator
// const domready = documentReady()

// // export default singleton
// console.log('Module assigned to window.OneReady. Logged below:')
//       console.log(domready)

//       domready.then(() => console.log('One ready.'))
//       domready.then(() => console.log('Two ready.'))



</script>




</body>
</html>