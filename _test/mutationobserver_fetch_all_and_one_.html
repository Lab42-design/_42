<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

<div rel="partial">
    <link rel="html" href="./01.html" />
</div>

<div rel="partial">
    <link rel="html" href="./02.html" />
</div>

<div rel="partial">
    <link rel="html" href="./03.html" />
</div>




    <div>

    </div>





<!-- _42 scripts -->
<script module src="../ui/js/promise_dom.js"></script>
<script module src="../ui/js/fetch_partial.js"></script>

<!---
<script>
    console.clear()

// include partials callback fn
// callback executed when canvas was found
function includeOne(target) {
    const partial = new FetchPartial()
    partial.fetchOne(target[i])
    for (let i = 0; i < target.length; i++) {
        partial.fetchOne(target[i])
    }
    // for(let entry of target.entries()) {
    //     const partial = new FetchOne()
    //     partial.fetchPartial(entry[1])
    // }
}

function includeAll(target) { 
    const partial = new FetchPartial()
    partial.fetchAll()
}

// set up the mutation observer
// `mutations` is an array of mutations that occurred
// `me` is the MutationObserver instance
var observer = new MutationObserver(function (mutations, me) {
    const target = document.querySelectorAll('link[rel="html"]')
    // const target = document.querySelector('body');
    // const target = document.body.link

    // if target is found then do something with it
    // and stop observing
    if (target) {
        const dom = new PromiseDom()
        dom.ready.then(() => includeAll(target))
        me.disconnect() 
        // observer
        return;
    } else {
        console.log('target found ELSE')
    }
})

// start observing
const config = { 
    childList: true,
    attributes: true,
    characterData: true,
    subtree: true,
    attributeOldValue: true,
    characterDataOldValue: true
}

observer.observe(document, config)


</script>
-->

<h4>code</h4>
<pre>
<code>

</code>
</pre>


<script>

let count = 0;

var observerTWO = new MutationObserver(function(mutations, observer) {

    count++;

    console.log(`I've observed this number of changes: ${count}`)
    // for (let mutation of mutations) {
    //     if (mutation.type === 'childList') {
    //     console.log('+++++++ Mutation Detected: A child element has been added or removed.');
    //     }
    // }
    const partial2 = new FetchPartial()
    // (function (mutations, me)
    // throttle(updatePosition, 100)
    function throttle (callback, limit) {
        let waiting = false                       // Initially, we're not waiting
        return function () {                      // We return a throttled function
            if (!waiting) {                       // If we're not waiting
                callback.apply(this, arguments)   // Execute users function
                waiting = true                    // Prevent future invocations
                setTimeout(function () {          // After a period of time
                    waiting = false               // And allow future invocations
                }, limit)
            }
        }
    }

    mutations.forEach(function(mutation) {

        console.log('XXX____________mutation02')
        // console.log(mutation.target.querySelector('link[rel="html"]').href)
        partial2.fetchOne(mutation.target.querySelector('link[rel="html"]').href)
        console.log('XXX____________mutation02')

        // if(target2) {
        //     console.log('____________03')
        //     let aaa = throttle(console.log('aha___'), 100)
        //     for (let i = 0; i < target2.length; i++) {
        //         partial2.fetchOne(target2[i])
        //         // observerTWO.disconnect() 
        //     }
        // }


        const target2 = document.querySelectorAll('link[rel="html"]')

        if(target2) {
            console.log('____________03')
            let aaa = throttle(console.log('aha___'), 100)
            for (let i = 0; i < target2.length; i++) {
                // partial2.fetchOne(target2[i])
                // observerTWO.disconnect() 
            }
        }
        // observer.disconnect() 
        // observerTWO.disconnect() 
    });  
    // observerTWO.disconnect() 
})


// childList: true,
// attributes: true,
// characterData: false,
// subtree: false,
// attributeFilter: ['one', 'two'],
// attributeOldValue: false,
// characterDataOldValue: false

const config2 = { attributes: true, childList: true, characterData: true, subtree: true };
observerTWO.observe(document, config2);


// observerTWO.disconnect() 



</script>







<script>

MutationObserver = window.MutationObserver || window.WebKitMutationObserver

let countX = 0;


// define a new observer
let obs = new MutationObserver(function(mutations, observer) {

    countX++;

    console.log("________________ X F G")
    console.log(`________________ X F G changes: ${countX}`)

    // look through all mutations that just occured
    for(let i=0; i<mutations.length; ++i) {

        console.log("________________ FORLOOP 1")

        console.log('NUMBER: ', i, ' ___ MUTATION LENGHT: ', mutations.length)


        let countXX = 0;

        // look through all added nodes of this mutation
        for(var j=0; j<mutations[i].addedNodes.length; ++j) {

            countXX++;

            console.log("________________ FORLOOP 2")

            // was a child added with ID of 'bar'?
            if(mutations[i].addedNodes[j]) {

                console.log("________________ FORLOOP 2 IF IF IF")
                console.log(`________________ countXX === : ${countXX}`)

                console.log(mutations[i].addedNodes[j])

                console.log("bar was added!");
            }


        }


    }


});

// have the observer observe foo for changes in children
obs.observe(document, {
  childList: true,
  subtree: true
});









</script>





</body>
</html>