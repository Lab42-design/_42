<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>nested partials and MutationObserver</title>
</head>
<body>

<style>
blockquote {
    background-color: rgba(222, 184, 135, 0.445);
    padding: 30px;
}
</style>




<div class="myList">
    <link rel="html" href="./foo.html" />
</div>

<div class="partial">
    <link rel="html" href="./bar.html" />
</div>

<div class="partial">
    <link rel="html" href="./foobar.html" />
</div>



<!-- _42 scripts -->
<!-- <script module src="../ui/js/promise_dom.js"></script>
<script module src="../ui/js/fetch_partial.js"></script> -->
<script module src="../ui/js/42.js"></script>

<script>
"use strict";

console.clear()

const dom = new PromiseDom()
dom.ready.then(() => ___launch('9 8 7 6 5 4 3 2 1 0'))

// // LAUNCH
function ___launch(message) {
    console.log(message)

    const partial = new FetchPartial()
    const target = document.querySelectorAll('link[rel="html"]')

    if(target) {
        for (let i = 0; i < target.length; i++) {
            partial.fetchOne(target[i])
        }
    }

}







let observer = new MutationObserver(mutations => {

  for(let mutation of mutations) {
    // examine new nodes, is there anything to highlight?
    console.log('---01')


    // mutations.forEach(function (mutation) {
    //     console.log(mutation.type, "added: " + mutation.addedNodes.length + "  nodes")
    //     console.log(mutation.type, "removed: " + mutation.removedNodes.length + " nodes")
    // });



    for(let node of mutation.addedNodes) {

        console.log('------02')

        // we track only elements, skip other nodes (e.g. text nodes)
        if (!(node instanceof HTMLElement)) {
            console.log('! instanceof')
            continue
        } else {
            console.log('instanceof')
            console.log(node)

            console.log('ID_')
            console.log(node.id)

            if (node.matches('link')) {
                console.log('hello')
                partial.fetchOne(node)
                // Prism.highlightElement(node);
            }
            

            // console.log('------ELSE')
        }


    //   console.log(node.matches('link[rel="html"]'))

      // check the inserted element for being a code snippet
    //   if (node.matches('link')) {
    //       console.log('hello')
    //     // Prism.highlightElement(node);
    //   }

      // or maybe there's a code snippet somewhere in its subtree?
    //   for(let elem of node.querySelectorAll('pre[class*="language-"]')) {
        // Prism.highlightElement(elem);
    //   }


    }
  }

});

let demoElem = document.querySelector('body');

observer.observe(demoElem, {childList: true, subtree: true});
</script>




<!-- 
<script>
    

const options = {
    childList: true,
    attributes: false,
    characterData: false,
    subtree: false,
    // attributeFilter: ['one', 'two'],
    attributeOldValue: false,
    characterDataOldValue: false
}


const partial = new FetchPartial()


const element = document.querySelector('body');


let count = 0
let countXX = 0
let countXXX = 0

const observer = new MutationObserver(function(mutations, observer) {
    // console.log('callback that runs when observer is triggered')

    count++
    console.log(`count A: ${count}`)
    // const target = document.querySelectorAll('link[rel="html"]')

    

    for (let mutation of mutations) {

        countXX++
        console.log(`count B: ${countXX}`)

        if (mutation.type === 'childList') {

            // console.log('__________ childList')

            // if(target) {
            //     for (let i = 0; i < target.length; i++) {
            //         partial.fetchOne(target[i])
            //     }
            // }

            const target = document.querySelectorAll('link[rel="html"]')

            if(target) {

                // console.log('___IF TARGET')

                for (let i = 0; i < target.length; i++) {

                    console.log('__________')

                    countXXX++
                    console.log(`count C: ${countXXX}`)

                    // partial.fetchOne(target[i])\
                    
                    console.log(target[i])
                }
            }

            
        }

    }



});


observer.observe(element, options);

</script>

a -->



</body>
</html>