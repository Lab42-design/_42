<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./ui/reset.css" />
</head>
<body>


<main>
    <div rel="html" id="main" />
</main>




<script>



// makeRequest('Google').then(response => {
//     console.log('Response Received')
//     return processRequest(response)
// }).then(processResponse => {
//     console.log('Processing Response')
// }).catch(error => {
//     console.log(error)
// })



//
// function makeRequest(location) {
//     return new Promise((resolve, reject) => {
//         console.log(`Making request to ${location}`)
//         if (location === 'Google') {
//             resolve('Google says hi')
//         } else {
//             reject('We can only talk to Google')
//         }
//     })
// }

// //
// function processRequest(response) {
//     return new Promise((resolve, reject) => {
//         console.log('Processing response')
//         resolve(`Extra information ${response}`)
//     })
// }

// //
// async function doWork() {
//     try {
//         const response = await makeRequest('Google')
//         console.log('makeRequest')
//         const processedResponse = await processRequest(response)
//         console.log('processedResponse')
//     } catch(error) {
//         console.log(error)
//     }
// }

// doWork()



</script>

<script>
'use strict';



class doDo {

    constructor() {
        // this.partialTag = partialTag
    }

    // static all(el) {
    //     const partialTags = document.getElementsByTagName(el);
    //     for (let i = 0; i < partialTags.length; i++) {
    //         this.partial(partialTags[i]);
    //     }
    // }

    // static oneById(id) {
    //     const partialTag = document.getElementById(id);
    //     this.partial(partialTag);
    // }


    //
    makeRequest(location) {

        return new Promise((resolve, reject) => {

            fetch(location).then(function (partial) {

                // const contentType = partial.headers.get('Content-Type') || '';

                // if (contentType.includes('text/html')) {
                    
                // }

                if (partial.status == 200) {
                    return partial.text()
                } else {
                    reject('Partial not found')
                }
            }).then(html => {
                resolve(html)
            })


            // console.log(`Making request to ${location}`)

            // fetch(location).then(function (response) {
            //     if (response.status == 200) {
            //         return response.text()
            //     } else {
            //         console.log('ERROR 1 ')
            //     }
            // }).then(html => {
            //     resolve(html)
            // })
            // .catch(function (error) {
            //     // throw 'HTTP error / ' + error;
            //     // HTMLElement.parentNode.innerHTML = 'Sorry, an error occured / 404';
            // })

            // if (location === './d.html') {
            //     resolve('Google says hi')
            // } else {
            //     reject('We can only talk to Google')
            // }

            // resolve('Google says hi')

        })
    }

    //
    processRequest(response) {
        return new Promise((resolve, reject) => {
            
            // resolve(`Extra information ${response}`)



            // console.log( '______ response === ' + response)

            // 3
            const HTMLElement = document.querySelector('#main')

            if (HTMLElement.attributes.rel.value === "html") {
                resolve(HTMLElement.parentNode.innerHTML = response)
            }
            // } else {
                reject('No tag for html')
            // }

        })
    }

    // url === path to partial
    async dadaDa(url) {

        try {

            // 1
            const response = await this.makeRequest(url)

            // 2 process response
            const processedResponse = await this.processRequest(response)

        } catch(error) {
            console.error(error)
        }
    }




    // static async partial(HTMLElement) {

    //     const file = HTMLElement.getAttribute("href");

    //     return new Promise((resolve, reject) => {
    //         const headers = new Headers();
    //         const request = new Request(file, {
    //             method: 'GET',
    //             headers: headers,
    //             mode: 'cors',
    //             cache: 'default',
    //         });

    //         fetch(request).then(function (response) {
    //             credentials: 'same-origin' // https://github.com/github/fetch
    //             if (response.status == 200) {
    //                 return response.text();
    //             } else {
    //                 return Promise.reject(response);
    //             }
    //         }).then(html => {
    //             if (HTMLElement.attributes.rel.value === "html") {
    //                 HTMLElement.parentNode.innerHTML = html;
    //             }
    //             resolve(html);
    //         }).catch(function (error) {
    //             throw 'HTTP error / ' + error;
    //             HTMLElement.parentNode.innerHTML = 'Sorry, an error occured / 404';
    //         })
    //     })
    // }





}



const dodoDo = new doDo();

console.log(dodoDo.dadaDa('./d.html'));

</script>



</body>
</html>