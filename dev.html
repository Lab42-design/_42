<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="./ui/reset.css" />
</head>
<body>


<main>



<article class="partial">
    <link id="___D___01" rel="html" href="./d1.html" />
</article>

<article class="partial">
    <link id="___D___02" rel="html" href="./d2.html" />
</article>

<article class="partial">
    <link id="___D___03" rel="html" href="./d3.html" />
</article>










</main>



<script>
'use strict';



class Partial {

    constructor() {
        // this.partialTag = partialTag
    }

    all(el) {
        const partials = document.getElementsByTagName(el)

        for (let i = 0; i < partials.length; i++) {
            if (partials[i].attributes.rel.value === "html") {
                const file = partials[i].getAttribute("href")
                this.include(file, partials[i])
            } 
        }
    }

    _makeRequest(location) {
        return new Promise((resolve, reject) => {
            fetch(location).then(function (partial) {
                if (partial.status == 200) {
                    return partial.text()
                } else {
                    reject('Partial not found')
                }
            }).then(html => {
                resolve(html)
            })
        })
    }

    _processRequest(response, el) {
        return new Promise((resolve, reject) => {
            if (el.attributes.rel.value === "html") {
                resolve(el.parentNode.innerHTML = response)
            } else {
                reject('No tag for html')
            }
        })
    }

    async include(url, id) {
        console.log('include')
        try {

            // 1
            const response = await this._makeRequest(url)

            // 2 process response
            const processedResponse = await this._processRequest(response, id)

        } catch(error) {
            console.error(error)
        }
    }




}



// const dodoDo = new doDo()
// dodoDo.dadaDa('./d.html');

const partial = new Partial()
partial.all('link')

// console.log(dodoDo.dadaDa('./d.html'));

</script>



</body>
</html>